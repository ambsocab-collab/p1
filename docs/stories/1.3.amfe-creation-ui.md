# Story 1.3: AMFE Creation & Management UI

## Status
Approved

## Story
**As a** usuario de calidad,
**I want** crear nuevos AMFEs con información básica (nombre, tipo, scope),
**so that** iniciar análisis estructurados de riesgos.

## Acceptance Criteria
1. Formulario de creación de AMFE con campos: nombre, tipo (DFMEA/PFMEA), descripción, scope
2. Lista de AMFEs existentes con búsqueda y filtros básicos
3. Vista de detalle de AMFE con opción de editar/eliminar/duplicar
4. Validaciones de campos obligatorios
5. Guardado automático de cambios en Supabase
6. Indicadores visuales de estado (borrador, en progreso, completado)

## Tasks / Subtasks
- [ ] Task 1: Create AMFE list view component (AC: 2)
  - [ ] Create AMFEList component in apps/web/src/components/dashboard/AMFEList.tsx
  - [ ] Implement table/list layout with AMFE cards
  - [ ] Add search input for filtering by name
  - [ ] Add filter dropdowns for type and status
  - [ ] Display status indicators with color coding
- [ ] Task 2: Create AMFE creation form (AC: 1, 4)
  - [ ] Create AMFEForm component in apps/web/src/components/amfe/AMFEForm.tsx
  - [ ] Implement form fields: name (required), type (required), description, scope
  - [ ] Add form validation with error messages
  - [ ] Create type selector (DFMEA/PFMEA) with radio buttons
  - [ ] Add submit button with loading state
- [ ] Task 3: Create AMFE detail view (AC: 3)
  - [ ] Create AMFEDetail component in apps/web/src/components/amfe/AMFEDetail.tsx
  - [ ] Display all AMFE information in read-only mode
  - [ ] Add edit button to switch to edit mode
  - [ ] Add delete button with confirmation modal
  - [ ] Add duplicate button to create copy with new name
- [ ] Task 4: Implement CRUD operations (AC: 5)
  - [ ] Create AMFE service in apps/web/src/services/amfe.ts
  - [ ] Implement createAMFE function with API call
  - [ ] Implement updateAMFE function with auto-save
  - [ ] Implement deleteAMFE function with confirmation
  - [ ] Implement duplicateAMFE function
- [ ] Task 5: Add routing and navigation (AC: 2, 3)
  - [ ] Create routes: /amfes (list), /amfes/new (create), /amfes/:id (detail)
  - [ ] Add navigation buttons in components
  - [ ] Implement breadcrumb navigation
  - [ ] Handle 404 for non-existent AMFEs
- [ ] Task 6: Add status management (AC: 6)
  - [ ] Create StatusBadge component for visual indicators
  - [ ] Define status colors: draft (gray), in_progress (blue), completed (green), archived (gray)
  - [ ] Add status change buttons in detail view
  - [ ] Update status automatically when items are added

## Dev Notes

### Previous Story Insights
Stories 1.1 and 1.2 provide the foundation:
- Project structure and Supabase connection ready
- Database schema and API endpoints available
- TypeScript types generated for AMFE entities

### Component Architecture
From frontend-architecture.md: [Source: architecture/frontend-architecture.md#component-organization]
- AMFE components in apps/web/src/components/amfe/
- Dashboard components in apps/web/src/components/dashboard/
- Pages in apps/web/src/pages/
- Services in apps/web/src/services/

### State Management
From frontend-architecture.md: [Source: architecture/frontend-architecture.md#state-management-architecture]
- Use Zustand for AMFE state management
- Create amfeStore with currentAMFE, items, loading, error states
- Implement optimistic updates for better UX
- Auto-save changes to Supabase with debouncing

### API Integration
From frontend-architecture.md: [Source: architecture/frontend-architecture.md#api-client-setup]
- Use typed Supabase client from Story 1.2
- Implement CRUD operations using APIClient class
- Handle errors gracefully with user-friendly messages
- Show loading states during API calls

### Form Validation
- Required fields: name, type
- Use react-hook-form for validation
- Show inline error messages
- Disable submit button until valid
- Clear validation on successful submission

### UI Components
From design-system-implementation.md: [Source: architecture/design-system-implementation.md]
- Use base UI components from components/ui/
- StatusBadge component for state indicators
- Modal component for delete confirmations
- Form components with consistent styling

### Routing
From frontend-architecture.md: [Source: architecture/frontend-architecture.md#routing-architecture]
- Use React Router DOM v6
- Implement protected routes with optional auth
- Handle navigation between list, create, and detail views
- Pass AMFE ID as URL parameter

### File Locations
Based on unified-project-structure.md: [Source: architecture/unified-project-structure.md]
- AMFE components: apps/web/src/components/amfe/
- Dashboard components: apps/web/src/components/dashboard/
- Pages: apps/web/src/pages/
- Services: apps/web/src/services/
- Stores: apps/web/src/stores/
- Types: packages/shared/src/types/

### Data Models
From data-models.md: [Source: architecture/data-models.md]
- AMFE interface with id, name, type, description, status
- Status enum: draft, in_progress, completed, archived
- Type enum: DFMEA, PFMEA
- Timestamps for created_at and updated_at

### Auto-save Implementation
- Implement debounced auto-save (30 seconds or on field change)
- Show "saving..." indicator during save
- Show "saved" confirmation after successful save
- Handle offline scenario with queue for later sync

### Search and Filter
- Search by AMFE name (case-insensitive)
- Filter by type (DFMEA/PFMEA)
- Filter by status
- Combine multiple filters
- Reset filters button

### Error Handling
- Show user-friendly error messages
- Log errors to console for debugging
- Retry failed operations automatically
- Allow manual retry option

### Testing
- Unit tests for components
- Integration tests for CRUD operations
- Form validation tests
- Error scenario tests
- E2E tests for user flows

## Testing
### Testing Standards
- Test location: apps/web/tests/
- Framework: Jest + React Testing Library
- Test component rendering with different states
- Test form validation and submission
- Mock API calls in unit tests
- Test error scenarios

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-31 | 1.0 | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record
### Agent Model Used
<!-- To be populated by dev agent -->

### Debug Log References
<!-- To be populated by dev agent -->

### Completion Notes List
<!-- To be populated by dev agent -->

### File List
<!-- To be populated by dev agent -->

## QA Results
<!-- To be populated by QA agent -->